<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <title>Linux下编译安装Mysql</title>
        <meta charset="UTF-8">
        <meta name="keywords"    content="">
        <meta name="description" content="centos 7 下编译 mysql 5.7.17 的源码并安装和使用">
        <meta name="viewport"    content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
        <meta name="author"      content="Liyu, kissaoe@gmail.com">
        <meta name="copyright"   content="Liyu">
        <meta name="renderer"    content="webkit">
        <meta http-equiv="cache-control" content="no-cache">
        <link rel="stylesheet" type="text/css" href="https://static.heleeos.com/lib/bootstrap/css/bootstrap.css">
        <link rel="stylesheet" type="text/css" href="https://static.heleeos.com/lib/font-awesome/css/font-awesome.css">
        <link rel="stylesheet" type="text/css" href="https://static.heleeos.com/blog-web/css/common.css">
        <link rel="stylesheet" type="text/css" href="https://static.heleeos.com/blog-web/css/style.css">
        <link rel="stylesheet" type="text/css" href="https://static.heleeos.com/blog-web/css/blog.css">
        <link rel="shortcut icon" href="https://heleeos.com/favicon.ico" /> 
        <script src="https://api.heleeos.com/blog/linux-install-source-mysql.js"></script>
    </head>
    <body>
        <div class="header hidden-xs col-sm-12">
            <a href="https://heleeos.com/" class="logo">
                <img class="logo-image" src="https://static.heleeos.com/logo.png"></img>
            </a>
            <nav class="main-nav">
                <a class="main-nav-link" href="https://heleeos.com/">主页</a>
                <a class="main-nav-link" href="https://heleeos.com/time/">时间轴</a>
                <a class="main-nav-link" href="">技术干货</a>
                <a class="main-nav-link" href="">读书感悟</a>
                <a class="main-nav-link" href="https://heleeos.com/profile/index.html">关于我</a>
            </nav>
            <nav class="profile-nav hidden-lg">
                <img class="profile-image" src="https://static.heleeos.com/blog-web/image/profile.jpg">
                <a href="javascript:;"><i class="fa fa-caret-down"></i></a>
            </nav>
        </div>

        <div class="header visible-xs-block" style="height: 50px;">
            <nav class="mobile-nav">
                <a class="mobile-nav-link" href="https://heleeos.com/">主页</a>
                <a class="mobile-nav-link" href="https://heleeos.com/time/">时间轴</a>
                <a class="mobile-nav-link" href="https://heleeos.com/profile/index.html">关于我</a>
            </nav>
        </div>
        
        <div class="container-fluid">
            <div class="left visible-lg-inline-block col-lg-3">
                <div class="card">
                    <img class="profile-image" src="https://static.heleeos.com/blog-web/image/profile.jpg">
                    <p class="profile-name">李瑜</p>
                    <p class="profile-info">爱生活，爱学习，更爱写代码<br>爱折腾的全栈开发工程师<br>前端，后台，运维</p>
                    <p class="profile-location"><i class="fa fa-map-marker"></i>中国 - 上海</p>
                    <a class="profile-button btn" href="https://github.com/greenfit" target="_blank">Follow</a>
                    <div class="profile-other">
                        <a href="https://git.oschina.net/IP" target="_blank"><i class="fa fa-git"></i></a>
                        <a href="https://codepen.io/greenfit/" target="_blank"><i class="fa fa-codepen"></i></a>
                        <a href="https://www.freecodecamp.com/greenfit" target="_blank"><i class="fa fa-free-code-camp"></i></a>
                        <a href="mailto:kissaoe@gmail.com?subject=I Love You~" target="_blank"><i class="fa fa-envelope"></i></a>
                        <a href="https://www.facebook.com/profile.php?id=100010520951879" target="_blank"><i class="fa fa-facebook"></i></a>
                    </div>
                </div>
                <h3>微信订阅号</h3> 
                <img src="https://static.heleeos.com/blog-web/image/qrcode.jpg">
            </div>
            <div class="main col-xs-12 col-sm-9 col-md-9 col-lg-7">
                <div class="card">
                    <h1 class="title"><a></a></h1>
                    <div class="meta">
                        <div class="time"><i class="fa fa-calendar"></i>2017-03-29 09:58:19</div>
                        <div class="type"><i class="fa fa-folder"></i>2</div>
                        <div class="count"><i class="fa fa-bookmark"></i>23 次</div>
                        <div class="tag"><i class="fa fa-tags"></i><a href="">linux</a><a href="">mysql</a></div>
                    </div>
                    <div class="info">摘要:centos 7 下编译 mysql 5.7.17 的源码并安装和使用</div>
                    <hr>
                    <div class="blog-body">
                        <h2 id="依赖条件">依赖条件</h2>
<h3 id="1下载mysql">1.下载Mysql</h3>
<p><code>https://cdn.mysql.com/Downloads/MySQL-5.7/mysql-5.7.17.tar.gz</code></p>
<h3 id="2下载boost">2.下载Boost</h3>
<p><code>https://nchc.dl.sourceforge.net/project/boost/boost/1.59.0/boost_1_59_0.tar.gz</code></p>
<h3 id="3安装依赖工具">3.安装依赖工具</h3>
<p><code>yum install -y gcc gcc-c++ bison ncurses ncurses-devel cmake</code></p>
<p><img src="https://image.heleeos.com/blog/linux-install-source-mysql/1.png" alt="" /></p>
<h3 id="4准备boost">4.准备boost</h3>
<p>解压 <code>boost_1_59_0.tar.gz</code> 压缩包</p>
<pre><code>tar -zxvf boost_1_59_0.tar.gz</code></pre>
<p><img src="https://image.heleeos.com/blog/linux-install-source-mysql/2.png" alt="" /></p>
<p>移动到 <code>/usr/local</code> 下并重命名为 <code>boost</code></p>
<pre><code class="  language- ">mv boost_1_59_0 /usr/local/ 
mv /usr/local/boost_1_59_0/ /usr/local/boost/ </code></pre>
<p><img src="https://image.heleeos.com/blog/linux-install-source-mysql/3.png" alt="" /></p>
<h2 id="帐号和目录">帐号和目录</h2>
<h3 id="1准备帐号">1.准备帐号</h3>
<p>新增用户和群组 <code>mysql</code> 并且不能够登陆</p>
<pre><code>groupadd mysql
useradd mysql -g mysql -M -s /sbin/nologin</code></pre>
<p><img src="https://image.heleeos.com/blog/linux-install-source-mysql/4.png" alt="" /></p>
<h3 id="2创建目录">2.创建目录</h3>
<p>创建安装目录 <code>/usr/local/mysql</code> 和数据目录 <code>/var/mysqldata</code></p>
<pre><code>mkdir -p /usr/local/mysql
mkdir -p /var/mysqldata</code></pre>
<p><img src="https://image.heleeos.com/blog/linux-install-source-mysql/5.png" alt="" /></p>
<h3 id="3修改属性">3.修改属性</h3>
<pre><code>chown -R mysql:mysql /usr/local/mysql
chown -R mysql:mysql /var/mysqldata</code></pre>
<p><img src="https://image.heleeos.com/blog/linux-install-source-mysql/6.png" alt="" /></p>
<h2 id="编译mysql源码">编译Mysql源码</h2>
<h3 id="1解压源码压缩包">1.解压源码压缩包</h3>
<pre><code>tar -zxvf mysql-5.7.17.tar.gz</code></pre>
<p><img src="https://image.heleeos.com/blog/linux-install-source-mysql/7.png" alt="" /></p>
<h3 id="2编译安装mysql">2.编译安装mysql</h3>
<p>进行编译前配置</p>
<ul>
<li>安装目录 <code>DCMAKE_INSTALL_PREFIX</code> 为 <code>/usr/local/mysql</code></li>
<li>数据目录 <code>DMYSQL_DATADIR</code> 为 <code>/var/mysqldata</code></li>
<li>配置目录 <code>DSYSCONFDIR</code> 为 <code>/etc</code></li>
<li>boost目录 <code>DWITH_BOOST</code> 为 <code>/usr/local/boost</code></li>
</ul>
<pre><code>cmake -DCMAKE_INSTALL_PREFIX=/usr/local/mysql \
-DMYSQL_DATADIR=/var/mysqldata \
-DSYSCONFDIR=/etc \
-DMYSQL_UNIX_ADDR=/tmp/mysql.sock \
-DMYSQL_USER=mysql \
-DMYSQL_TCP_PORT=3306 \
-DWITH_MYISAM_STORAGE_ENGINE=1 \
-DWITH_INNOBASE_STORAGE_ENGINE=1 \
-DWITH_MEMORY_STORAGE_ENGINE=1 \
-DWITH_PARTITION_STORAGE_ENGINE=1 \
-DDEFAULT_CHARSET=utf8 \
-DDEFAULT_COLLATION=utf8_general_ci \
-DEXTRA_CHARSETS=all \
-DENABLED_LOCAL_INFILE=1 \
-DWITH_BOOST=/usr/local/boost</code></pre>
<p><img src="https://image.heleeos.com/blog/linux-install-source-mysql/8.png" alt="" /></p>
<p>配置完成后如下图所示</p>
<p><img src="https://image.heleeos.com/blog/linux-install-source-mysql/9.png" alt="" /></p>
<p>开始编译安装</p>
<pre><code>make &amp;&amp; make install</code></pre>
<p><img src="https://image.heleeos.com/blog/linux-install-source-mysql/10.png" alt="" /></p>
<p>等待30 ~ 50 分钟</p>
<p><img src="https://image.heleeos.com/blog/linux-install-source-mysql/11.png" alt="" /></p>
<h3 id="3修改配置文件">3.修改配置文件</h3>
<p>根据刚才配置的配置目录 <code>DSYSCONFDIR</code> 为 <code>/etc</code> , 所以修改命令为</p>
<pre><code>vim /etc/my.cnf</code></pre>
<p><img src="https://image.heleeos.com/blog/linux-install-source-mysql/12.png" alt="" /></p>
<p><a href="https://image.heleeos.com/blog/linux-install-source-mysql/my.cnf">参考配置 - my.cnf</a></p>
<h3 id="4初始化">4.初始化</h3>
<pre><code>/usr/local/mysql/bin/mysqld --initialize --user=mysql --datadir=/var/mysqldata/ --basedir=/usr/local/mysql/ &amp;</code></pre>
<p><img src="https://image.heleeos.com/blog/linux-install-source-mysql/13.png" alt="" /></p>
<p>红框中的为数据库 <code>root</code> 的初始密码</p>
<h2 id="使用mysql">使用mysql</h2>
<h3 id="1启动">1.启动</h3>
<pre><code>/usr/local/mysql/bin/mysqld_safe --basedir=/usr/local/mysql --datadir=/var/mysqldata/ --user=mysql</code></pre>
<p>如果提示出错 <code>Create writable for user 'mysql'</code> 可以执行 <code>touch &amp;&amp; chown</code></p>
<p><img src="https://image.heleeos.com/blog/linux-install-source-mysql/14.png" alt="" /></p>
<pre><code>touch centos-test.err
chown -R mysql:mysql /var/mysqldata</code></pre>
<p><img src="https://image.heleeos.com/blog/linux-install-source-mysql/15.png" alt="" /></p>
<p>正确启动界面如下:</p>
<p><img src="https://image.heleeos.com/blog/linux-install-source-mysql/16.png" alt="" /></p>
<h3 id="2连接mysql">2.连接mysql</h3>
<pre><code>/usr/local/mysql/bin/mysql -uroot -p</code></pre>
<p>然后输入刚才的生成的初始化密码</p>
<p><img src="https://image.heleeos.com/blog/linux-install-source-mysql/17.png" alt="" /></p>
<h3 id="3修改密码">3.修改密码</h3>
<pre><code>set password for 'root'@'localhost'=password('admin');</code></pre>
<p><img src="https://image.heleeos.com/blog/linux-install-source-mysql/18.png" alt="" /></p>
<h2 id="mysql常见问题">Mysql常见问题</h2>
<h3 id="1重置密码">1.重置密码</h3>
<p>如果忘记root密码或者不记得初始化密码,可以通过 <code>skip-grant-tables</code> 重置密码</p>
<pre><code>/usr/local/mysql/bin/mysqld_safe --basedir=/usr/local/mysql --datadir=/var/mysqldata/ --user=mysql --skip-grant-tables &amp;</code></pre>
<p>然后可以直接用<code>root</code>登陆进去</p>
<pre><code>/usr/local/mysql/bin/mysql -uroot</code></pre>
<p><img src="https://image.heleeos.com/blog/linux-install-source-mysql/19.png" alt="" /></p>
<h3 id="2创建用户">2.创建用户</h3>
<p>创建<code>root</code>用户, 密码为<code>admin</code>, 登陆主机限制为<code>%</code>(不限制), 并授权<code>all</code></p>
<pre><code>CREATE USER 'root'@'%' IDENTIFIED BY 'admin';

GRANT all ON *.* TO 'root'@'%';</code></pre>
<h3 id="3定期备份">3.定期备份</h3>
<p>备份的原理主要是执行 <code>mysqldump</code>, Linux系统下是 <code>crontab</code></p>
<p>编写一个shell脚本 <code>backupmysql.sh</code></p>
<pre><code>#!/bin/bash

time=` date +%Y%m%d `

/usr/local/mysql/bin/mysqldump -u用户名 -p密码 数据库 &gt; /var/mysqlbackup/database_$time.sql(保存的文件)</code></pre>
<ol>
<li>指定文件 <code>crontab /etc/crontab</code></li>
<li>便捷文件 <code>crontab -e</code></li>
<li>编写指令 <code>30 * * * * root /var/mysqlbackup/backupmysql.sh</code>, 表示当分钟为30时进行执行</li>
</ol>
<p>crontab的格式如下:</p>
<pre>
.---------------- minute (0 - 59)
|  .------------- hour (0 - 23)
|  |  .---------- day of month (1 - 31)
|  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...
|  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat
|  |  |  |  |
*  *  *  *  * user-name  command to be executed
分 时 日 月 星期 用户 命令
</pre>
                    </div>
                    <div class="blog-copy-info">
                        <p>以上内容是在下的一点愚见，有任何不对的地方，欢迎指出。</p>
                        <p>欢迎任何形式的转载，但请务必注明出处。</p>
                        <p>转载请注明：文章转载自 黑老李的博客[<a href="https://heleeos.com/blog/linux-install-source-mysql.html">https://heleeos.com</a>]</p>
                        <p>本文标题：Linux下编译安装Mysql</p>
                        <p>本文地址：https://heleeos.com/blog/linux-install-source-mysql.html</p>
                    </div>
                </div>
            </div>
            <div class="right hidden-xs col-sm-3 col-md-3 col-lg-2"> 
                <h3>公告</h3> 
                <div class="card">
                    <div class="info">网站上线了</div>
                </div>
                <h3>分类</h3>
                <div class="type">
                    <ul class="type-list">
                            <li class="type-list-item">
                                <a class="type-list-link" href=""><i class="fa fa-caret-right"></i></a><span class="type-list-count">()</span>
                            </li>
                            <li class="type-list-item">
                                <a class="type-list-link" href=""><i class="fa fa-caret-right"></i></a><span class="type-list-count">()</span>
                            </li>
                            <li class="type-list-item">
                                <a class="type-list-link" href=""><i class="fa fa-caret-right"></i></a><span class="type-list-count">()</span>
                            </li>
                            <li class="type-list-item">
                                <a class="type-list-link" href=""><i class="fa fa-caret-right"></i></a><span class="type-list-count">()</span>
                            </li>
                            <li class="type-list-item">
                                <a class="type-list-link" href=""><i class="fa fa-caret-right"></i></a><span class="type-list-count">()</span>
                            </li>
                    </ul>
                </div>
                <h3>标签</h3>
                <div class="tags">
                    <a href="">Spring</a>
                    <a href="">Spring Bean</a>
                    <a href="">Spring MVC</a>
                    <a href="">MySQL</a>
                    <a href="">Java8</a>
                    <a href="">JVM</a>
                    <a href="">AOP</a>
                </div>
                <div class="catalog">
                    <span class="sidebar-scrollbar"></span>
                    <ul class="catalog-content"></ul>
                </div>
            </div>
        </div>
        <div class="footer">成长之旅 | 2017 &copy;<a href="https://heleeos.com/profile/" target="_blank">李瑜</a>
            <div class="beian">
                <p class="icp">豫ICP备 17009313 号 | 邮箱: <a href="mailto:kissaoe@gmail.com?subject=I Love You~" target="_blank">kissaoe@gmail.com</a></p>
                <a class="beian-link" target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41072102000352">
                    <img style="float: left;" src="https://static.heleeos.com/blog-web/image/beian.png"/>
                    <p class="beian-title">豫公网安备 41072102000352 号</p>
                </a>
            </div>
        </div>
        <script src="https://static.heleeos.com/lib/jquery.min.js"></script>
        <script src="https://static.heleeos.com/blog-web/js/blog.js"></script>
        <script type="text/javascript">
            (function(){
                var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan style='display:none;' id='cnzz_stat_icon_1261694742'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s4.cnzz.com/z_stat.php%3Fid%3D1261694742%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"));
            })();
        </script>
    </body>
</html>